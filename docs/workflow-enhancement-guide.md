# å·¥ä½œæµå¢å¼ºåŠŸèƒ½æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†Bilibili Flow v3.0.0ç‰ˆæœ¬ä¸­æ–°å¢çš„å·¥ä½œæµå¢å¼ºåŠŸèƒ½ã€‚

## ğŸ†• æ–°åŠŸèƒ½æ¦‚è§ˆ

### 1. CSVæ•°æ®å¯¼å‡º
- **åŠŸèƒ½**: å°†é‡‡é›†çš„æ•°æ®å¯¼å‡ºä¸ºCSVæ ¼å¼ï¼Œä¾¿äºæ•°æ®åˆ†æ
- **å…¼å®¹æ€§**: æ”¯æŒExcelã€pandasã€Rç­‰æ•°æ®åˆ†æå·¥å…·
- **ç¼–ç **: ä½¿ç”¨UTF-8-sigç¼–ç ï¼Œç¡®ä¿ä¸­æ–‡å­—ç¬¦æ­£ç¡®æ˜¾ç¤º

### 2. è§†é¢‘æ ‡ç­¾æå–
- **åŠŸèƒ½**: è‡ªåŠ¨æå–è§†é¢‘çš„æ ‡ç­¾å’Œåˆ†ç±»ä¿¡æ¯
- **ç”¨é€”**: ç”¨äºå†…å®¹åˆ†æã€æ ‡ç­¾è¶‹åŠ¿åˆ†æã€åˆ†ç±»ç»Ÿè®¡
- **æ•°æ®ç»“æ„**: åŒ…å«æ ‡ç­¾IDã€æ ‡ç­¾åç§°ã€åˆ†ç±»ä¿¡æ¯

### 3. çƒ­è¯„åŠŸèƒ½å¢å¼º
- **åŠŸèƒ½**: æœˆä»»åŠ¡ä¹Ÿæ”¯æŒçƒ­è¯„é‡‡é›†
- **æ”¹è¿›**: æä¾›æ›´å®Œæ•´çš„ç”¨æˆ·åé¦ˆæ•°æ®
- **åˆ†æä»·å€¼**: äº†è§£ç”¨æˆ·å¯¹ä¸åŒç±»å‹å†…å®¹çš„ååº”

### 4. æ‰‹åŠ¨æ‰§è¡Œæ¨¡å¼
- **æ”¹è¿›**: ç§»é™¤è‡ªåŠ¨å®šæ—¶ä»»åŠ¡ï¼Œæ”¹ä¸ºå®Œå…¨æ‰‹åŠ¨æ‰§è¡Œ
- **ä¼˜åŠ¿**: æ›´å¥½çš„æ‰§è¡Œæ§åˆ¶ï¼Œé¿å…ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—
- **çµæ´»æ€§**: å¯æ ¹æ®éœ€è¦éšæ—¶æ‰§è¡Œæ•°æ®é‡‡é›†

## ğŸ“Š CSVæ•°æ®æ ¼å¼è¯¦è§£

### è§†é¢‘æ•°æ®CSVå­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `aid` | æ•´æ•° | è§†é¢‘AVå· | `123456789` |
| `title` | æ–‡æœ¬ | è§†é¢‘æ ‡é¢˜ | `ã€æŠ€æœ¯åˆ†äº«ã€‘Pythonç¼–ç¨‹æŠ€å·§` |
| `video_url` | URL | è§†é¢‘é“¾æ¥ | `https://www.bilibili.com/video/BV1xx411c7mD` |
| `cover_url` | URL | å°é¢å›¾ç‰‡é“¾æ¥ | `https://i0.hdslb.com/bfs/archive/xxx.jpg` |
| `publish_time` | æ—¥æœŸæ—¶é—´ | å‘å¸ƒæ—¶é—´ | `2025-01-15 14:30:00` |
| `duration` | æ•´æ•° | è§†é¢‘æ—¶é•¿(ç§’) | `1200` |
| `category` | æ–‡æœ¬ | è§†é¢‘åˆ†ç±» | `ç§‘æŠ€` |
| `description` | æ–‡æœ¬ | è§†é¢‘ç®€ä»‹ | `æœ¬æœŸè§†é¢‘ä»‹ç»Pythonç¼–ç¨‹æŠ€å·§...` |
| `tags` | æ–‡æœ¬ | è§†é¢‘æ ‡ç­¾(åˆ†å·åˆ†éš”) | `ç¼–ç¨‹; æŠ€æœ¯; æ•™ç¨‹; Python` |
| `view` | æ•´æ•° | æ’­æ”¾é‡ | `50000` |
| `like` | æ•´æ•° | ç‚¹èµæ•° | `1500` |
| `reply` | æ•´æ•° | è¯„è®ºæ•° | `200` |
| `favorite` | æ•´æ•° | æ”¶è—æ•° | `800` |
| `share` | æ•´æ•° | åˆ†äº«æ•° | `100` |
| `coin` | æ•´æ•° | æŠ•å¸æ•° | `300` |
| `danmaku` | æ•´æ•° | å¼¹å¹•æ•° | `500` |
| `hot_comments` | æ–‡æœ¬ | çƒ­è¯„æ‘˜è¦(åˆ†å·åˆ†éš”) | `å¤ªæ£’äº†; å­¦åˆ°äº†; æ„Ÿè°¢åˆ†äº«` |

### çƒ­è¯„æ•°æ®ç»“æ„

çƒ­è¯„æ•°æ®åŒ…å«ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š

```json
{
  "comment_id": "987654321",
  "message": "è¿™ä¸ªæ•™ç¨‹å¤ªæœ‰ç”¨äº†ï¼Œæ„Ÿè°¢UPä¸»çš„åˆ†äº«ï¼",
  "mid": 456789123,
  "uname": "æŠ€æœ¯çˆ±å¥½è€…",
  "ctime": 1705123456,
  "like": 150,
  "rcount": 12,
  "replies": [
    {
      "message": "åŒæ„Ÿï¼Œå­¦åˆ°å¾ˆå¤šï¼",
      "uname": "å­¦ä¹ è€…",
      "like": 20
    }
  ]
}
```

### è§†é¢‘æ ‡ç­¾æ•°æ®ç»“æ„

æ ‡ç­¾æå–åŠŸèƒ½æä¾›è¯¦ç»†çš„æ ‡ç­¾ä¿¡æ¯ï¼š

```json
{
  "tags": [
    {
      "tag_id": 12345,
      "tag_name": "ç¼–ç¨‹",
      "category": "ç§‘æŠ€"
    },
    {
      "tag_id": 12346,
      "tag_name": "Python",
      "category": "ç¼–ç¨‹è¯­è¨€"
    },
    {
      "tag_id": 12347,
      "tag_name": "æ•™ç¨‹",
      "category": "å­¦ä¹ "
    }
  ]
}
```

## ğŸ”§ é…ç½®è¯´æ˜

### CSVå¯¼å‡ºé…ç½®

åœ¨ `daily_task_config.yaml` ä¸­é…ç½®CSVå¯¼å‡ºé€‰é¡¹ï¼š

```yaml
storage:
  export_format: csv  # é€‰é¡¹: json, csv, both
  csv_options:
    encoding: utf-8-sig    # Excelå…¼å®¹ç¼–ç 
    delimiter: ','         # CSVåˆ†éš”ç¬¦
    include_headers: true  # åŒ…å«è¡¨å¤´
    escape_special_chars: true  # è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
```

### è§†é¢‘æ ‡ç­¾æå–é…ç½®

```yaml
task_config:
  daily_task:
    video_fields:
      tags:
        enabled: true           # å¯ç”¨æ ‡ç­¾æå–
        include_tag_id: true    # åŒ…å«æ ‡ç­¾ID
        include_tag_name: true  # åŒ…å«æ ‡ç­¾åç§°
        include_category: true  # åŒ…å«åˆ†ç±»ä¿¡æ¯
        max_tags: 20           # æœ€å¤§æ ‡ç­¾æ•°é‡
```

### çƒ­è¯„é‡‡é›†é…ç½®

```yaml
task_config:
  daily_task:
    hot_comments_json:
      enabled: true
      max_count: 10    # æ¯ä¸ªè§†é¢‘æœ€å¤šé‡‡é›†10æ¡çƒ­è¯„
      fields:          # é‡‡é›†çš„å­—æ®µ
        - message      # è¯„è®ºå†…å®¹
        - mid          # ç”¨æˆ·ID
        - ctime        # è¯„è®ºæ—¶é—´
        - like         # ç‚¹èµæ•°
        - rcount       # å›å¤æ•°
  
  monthly_task:
    hot_comments_json:
      enabled: true    # æœˆä»»åŠ¡ä¹Ÿå¯ç”¨çƒ­è¯„é‡‡é›†
      max_count: 10
      fields:
        - message
        - mid
        - ctime
        - like
        - rcount
```

## ğŸš€ æ‰‹åŠ¨æ‰§è¡Œå·¥ä½œæµ

### GitHub Actionsé…ç½®å˜æ›´

**ç§»é™¤çš„åŠŸèƒ½**:
- è‡ªåŠ¨å®šæ—¶ä»»åŠ¡(cronè°ƒåº¦)
- å¤æ‚çš„æ—¶é—´åˆ¤æ–­é€»è¾‘

**ä¿ç•™çš„åŠŸèƒ½**:
- æ‰‹åŠ¨è§¦å‘(workflow_dispatch)
- å®Œæ•´çš„æ•°æ®é‡‡é›†æµç¨‹
- é£ä¹¦é€šçŸ¥åŠŸèƒ½
- æ•°æ®æäº¤å’Œæ¨é€

### æ‰‹åŠ¨æ‰§è¡Œæ­¥éª¤

1. **è¿›å…¥Actionsé¡µé¢**
   - è®¿é—®GitHubä»“åº“
   - ç‚¹å‡»"Actions"æ ‡ç­¾

2. **é€‰æ‹©å·¥ä½œæµ**
   - `Daily Data Collection` - æ—¥ä»»åŠ¡
   - `Monthly Historical Data Collection` - æœˆä»»åŠ¡

3. **å¯åŠ¨æ‰§è¡Œ**
   - ç‚¹å‡»"Run workflow"æŒ‰é’®
   - é€‰æ‹©åˆ†æ”¯(é€šå¸¸æ˜¯`sync-current-files`)
   - å¡«å†™ä»»åŠ¡æè¿°(å¯é€‰)
   - ç‚¹å‡»"Run workflow"ç¡®è®¤

4. **ç›‘æ§æ‰§è¡Œ**
   - æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—
   - ç­‰å¾…å®Œæˆé€šçŸ¥

### æ‰§è¡Œç»“æœ

- **æ•°æ®æ–‡ä»¶**: è‡ªåŠ¨æäº¤åˆ°æŒ‡å®šåˆ†æ”¯
- **CSVæ–‡ä»¶**: ç”Ÿæˆå¤šä¸ªCSVæ–‡ä»¶ç”¨äºåˆ†æ
- **é€šçŸ¥**: å‘é€æ‰§è¡Œç»“æœåˆ°é£ä¹¦(å¦‚å·²é…ç½®)

## ğŸ“ˆ æ•°æ®åˆ†æç¤ºä¾‹

### ä½¿ç”¨pandasåˆ†æ

```python
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# è¯»å–è§†é¢‘æ•°æ®
videos_df = pd.read_csv('data/daily/2025-W31/23947287_20250803_videos.csv')

# 1. åŸºç¡€ç»Ÿè®¡åˆ†æ
print("è§†é¢‘æ•°æ®æ¦‚è§ˆ:")
print(videos_df.describe())

# 2. æ ‡ç­¾åˆ†æ
# å±•å¼€æ ‡ç­¾æ•°æ®
tags_series = videos_df['tags'].str.split(';').explode().str.strip()
tag_counts = tags_series.value_counts().head(20)

# ç»˜åˆ¶æ ‡ç­¾åˆ†å¸ƒå›¾
plt.figure(figsize=(12, 6))
tag_counts.plot(kind='bar')
plt.title('çƒ­é—¨æ ‡ç­¾åˆ†å¸ƒ')
plt.xlabel('æ ‡ç­¾')
plt.ylabel('é¢‘æ¬¡')
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()

# 3. è§†é¢‘è¡¨ç°åˆ†æ
# æ’­æ”¾é‡ä¸ç‚¹èµæ•°çš„å…³ç³»
plt.figure(figsize=(10, 6))
plt.scatter(videos_df['view'], videos_df['like'], alpha=0.6)
plt.xlabel('æ’­æ”¾é‡')
plt.ylabel('ç‚¹èµæ•°')
plt.title('æ’­æ”¾é‡ä¸ç‚¹èµæ•°å…³ç³»')
plt.show()

# 4. çƒ­è¯„åˆ†æ
hot_comments_df = pd.read_csv('data/daily/2025-W31/23947287_20250803_hot_comments.csv')

print(f"\nçƒ­è¯„ç»Ÿè®¡:")
print(f"æ€»çƒ­è¯„æ•°: {len(hot_comments_df)}")
print(f"å¹³å‡ç‚¹èµæ•°: {hot_comments_df['like'].mean():.1f}")
print(f"å¹³å‡å›å¤æ•°: {hot_comments_df['rcount'].mean():.1f}")

# çƒ­è¯„ç‚¹èµæ•°åˆ†å¸ƒ
plt.figure(figsize=(10, 6))
plt.hist(hot_comments_df['like'], bins=30, alpha=0.7)
plt.xlabel('ç‚¹èµæ•°')
plt.ylabel('é¢‘æ¬¡')
plt.title('çƒ­è¯„ç‚¹èµæ•°åˆ†å¸ƒ')
plt.show()
```

### ä½¿ç”¨Excelåˆ†æ

1. **æ‰“å¼€CSVæ–‡ä»¶**
   - é€‰æ‹©UTF-8ç¼–ç 
   - ç¡®è®¤åˆ†éš”ç¬¦ä¸ºé€—å·

2. **åˆ›å»ºæ•°æ®é€è§†è¡¨**
   - åˆ†æè§†é¢‘åˆ†ç±»åˆ†å¸ƒ
   - ç»Ÿè®¡æ ‡ç­¾ä½¿ç”¨é¢‘ç‡
   - è®¡ç®—å¹³å‡äº’åŠ¨ç‡

3. **åˆ¶ä½œå›¾è¡¨**
   - æ’­æ”¾é‡è¶‹åŠ¿å›¾
   - æ ‡ç­¾è¯äº‘
   - äº’åŠ¨æ•°æ®å¯¹æ¯”

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **CSVæ–‡ä»¶ä¹±ç **
   - ç¡®ä¿ä½¿ç”¨UTF-8ç¼–ç æ‰“å¼€
   - Excelä¸­é€‰æ‹©"æ•°æ®" â†’ "ä»æ–‡æœ¬/CSV"

2. **æ ‡ç­¾æ•°æ®ä¸ºç©º**
   - æ£€æŸ¥é…ç½®ä¸­tags.enabledæ˜¯å¦ä¸ºtrue
   - ç¡®è®¤è§†é¢‘ç¡®å®æœ‰æ ‡ç­¾ä¿¡æ¯

3. **çƒ­è¯„æ•°æ®ç¼ºå¤±**
   - æ£€æŸ¥hot_comments_json.enabledé…ç½®
   - ç¡®è®¤è§†é¢‘æœ‰è¶³å¤Ÿçš„çƒ­è¯„æ•°æ®

4. **æ‰‹åŠ¨æ‰§è¡Œå¤±è´¥**
   - æ£€æŸ¥GitHub Secretsé…ç½®
   - æŸ¥çœ‹Actionsæ‰§è¡Œæ—¥å¿—
   - ç¡®è®¤Cookieæœ‰æ•ˆæ€§

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **åˆç†è®¾ç½®é‡‡é›†å‚æ•°**
   - æ ¹æ®éœ€è¦è°ƒæ•´max_count
   - é¿å…è¿‡åº¦é‡‡é›†æ ‡ç­¾æ•°æ®

2. **å®šæœŸæ¸…ç†æ•°æ®**
   - åˆ é™¤è¿‡æœŸçš„CSVæ–‡ä»¶
   - å‹ç¼©å†å²æ•°æ®

3. **ç›‘æ§èµ„æºä½¿ç”¨**
   - å…³æ³¨GitHub Actionsä½¿ç”¨æ—¶é—´
   - åˆç†å®‰æ’æ‰§è¡Œé¢‘ç‡

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹é¡¹ç›®READMEæ–‡æ¡£
2. æ£€æŸ¥GitHub Issues
3. æäº¤æ–°çš„Issueæè¿°é—®é¢˜
4. åŒ…å«è¯¦ç»†çš„é”™è¯¯æ—¥å¿—å’Œé…ç½®ä¿¡æ¯

---

*æœ¬æ–‡æ¡£éšé¡¹ç›®æ›´æ–°è€Œæ›´æ–°ï¼Œè¯·å…³æ³¨æœ€æ–°ç‰ˆæœ¬ã€‚*